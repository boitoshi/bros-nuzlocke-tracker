# Bros Nuzlocke Tracker Database Configuration ğŸ—„ï¸
# é–‹ç™ºãƒ»æœ¬ç•ªç’°å¢ƒã¨ã‚‚ã«Supabase PostgreSQL

# é–‹ç™ºç’°å¢ƒï¼šSupabase PostgreSQL
development:
  adapter: postgresql
  encoding: unicode
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %>
  
  # Supabaseç”¨ã®DATABASE_URLè¨­å®š
  <% if ENV["DATABASE_URL"].present? %>
  url: <%= ENV["DATABASE_URL"] %>
  <% else %>
  # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
  host: <%= ENV["DATABASE_HOST"] || "localhost" %>
  port: <%= ENV["DATABASE_PORT"] || 5432 %>
  database: <%= ENV["DATABASE_NAME"] || "bros_nuzlocke_tracker_development" %>
  username: <%= ENV["DATABASE_USER"] || "postgres" %>
  password: <%= ENV["DATABASE_PASSWORD"] || "" %>
  <% end %>
  
  # Supabaseæœ€é©åŒ–è¨­å®š
  connect_timeout: 10
  read_timeout: 10
  write_timeout: 10
  checkout_timeout: 5
  sslmode: require

# ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼šSQLiteï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
# ç’°å¢ƒå¤‰æ•°ã«é–¢ä¿‚ãªãå¼·åˆ¶çš„ã«SQLiteã‚’ä½¿ç”¨
test:
  adapter: sqlite3
  database: storage/test.sqlite3
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %>
  timeout: 5000

# æœ¬ç•ªç’°å¢ƒï¼šPostgreSQLï¼ˆSupabase/Renderï¼‰
production:
  adapter: postgresql
  encoding: unicode
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %>
  
  # Supabaseç”¨ã®DATABASE_URLè¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒã®ã¿ï¼‰
  <% if Rails.env.production? && ENV["DATABASE_URL"].present? %>
  url: <%= ENV["DATABASE_URL"] %>
  <% else %>
  # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®šï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰
  host: <%= ENV["DATABASE_HOST"] || "localhost" %>
  port: <%= ENV["DATABASE_PORT"] || 5432 %>
  database: <%= ENV["DATABASE_NAME"] || "bros_nuzlocke_tracker_production" %>
  username: <%= ENV["DATABASE_USER"] || "postgres" %>
  password: <%= ENV["DATABASE_PASSWORD"] || "" %>
  <% end %>
  
  # Supabase + Renderæœ€é©åŒ–è¨­å®š
  connect_timeout: 15
  read_timeout: 15
  write_timeout: 15
  checkout_timeout: 5
  variables:
    statement_timeout: 30s
    lock_timeout: 10s
  # SSLå¿…é ˆï¼ˆSupabaseè¦ä»¶ï¼‰
  sslmode: require
  # IPv4å¼·åˆ¶ï¼ˆRender IPv6éå¯¾å¿œå¯¾ç­–ï¼‰
  hostaddr: <%= ENV["DATABASE_HOSTADDR"] if ENV["DATABASE_HOSTADDR"].present? %>
  # PostgreSQLæœ€é©åŒ–è¨­å®š
  application_name: "bros-nuzlocke-tracker-<%= Time.current.to_i %>"
  # æ¥ç¶šãƒ—ãƒ¼ãƒ«æœ€é©åŒ–
  reaping_frequency: 10
  # prepared statementåå‰é‡è¤‡å›é¿
  statement_limit: 1000
